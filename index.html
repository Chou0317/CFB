<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=400, height=640, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>CFB</title>
<link rel="stylesheet" href="style.css">

<script>
    window.onload = () => {
        const accInput = document.getElementById("account"); // 帳號欄位
        const pwdInput = document.getElementById("password"); // 密碼欄位
        const bindBtn = document.getElementById("bindBtn"); // 登入按鈕
        const unbindBtn = document.getElementById("unbindBtn"); // 解除按鈕
        const pushSection = document.getElementById("pushSection"); // 推播設定區
        const pushRadios = document.getElementsByName("push"); // 推播選項
        const pushBtn = document.getElementById("pushBtn"); // 送出按鈕
    
        // --- 載入推播設定 ---
        function loadPushSetting() {
            const savedPush = localStorage.getItem("push"); // 從 localStorage 取得先前設定
            if (savedPush === "on") {
                // 如果先前設定為 "on"，選擇 "開啟" radio
                document.querySelector('input[name="push"][value="on"]').checked = true;
            } else {
                // 沒有設定或為 "off"，選擇 "關閉" radio（預設）
                document.querySelector('input[name="push"][value="off"]').checked = true; // off
            }
        }
    
        // --- 登入後設定畫面 ---
        function afterBind() {
            accInput.readOnly = true; // 帳號欄位不可修改
            pwdInput.parentElement.style.display = "none"; //隱藏密碼欄位
            bindBtn.style.display = "none"; // 隱藏登入按鈕
            unbindBtn.style.display = "block"; // 顯示解除按鈕
            pushSection.style.display = "block"; // 顯示推播設定區
            loadPushSetting(); // 載入使用者先前選擇或預設
        }
    
        // --- 解除綁定後設定畫面 ---
        function afterUnbind() {
            accInput.value = ""; // 清空帳號欄位
            pwdInput.value = ""; // 清空密碼欄位
            accInput.readOnly = false; // 帳號可編輯
            pwdInput.parentElement.style.display = "block"; // 顯示密碼欄位
            bindBtn.style.display = "block"; // 顯示綁定按鈕
            unbindBtn.style.display = "none"; // 隱藏解除按鈕
            pushSection.style.display = "none"; // 隱藏推播設定區
            document.querySelector('input[name="push"][value="off"]').checked = true; // radio 回預設關閉
        }
    
        // --- 初始化頁面 ---
        const savedAcc = localStorage.getItem("account");
        if (savedAcc) {
            accInput.value = savedAcc; // 顯示已綁定帳號
            afterBind(); // 切換畫面到已綁定狀態
        } else {
            accInput.readOnly = false; // 帳號可編輯
            pwdInput.parentElement.style.display = "block"; // 顯示密碼欄位
            bindBtn.style.display = "block"; // 顯示綁定按鈕
            unbindBtn.style.display = "none"; // 隱藏解除按鈕
            pushSection.style.display = "none"; // 隱藏推播設定區
            loadPushSetting(); // 預設 radio 關閉
        }
    
        // --- 綁定 ---
        bindBtn.onclick = () => {
            const acc = accInput.value.trim(); // 去掉帳號前後空白
            const pwd = pwdInput.value.trim(); // 去掉密碼前後空白
            // 如果帳號或密碼為空，提示使用者
            if (acc === "" || pwd === "") { 
                alert("請輸入帳號與密碼"); 
                return; 
            }
    
            // 儲存帳號與密碼到 localStorage
            localStorage.setItem("account", acc);
            localStorage.setItem("password", pwd);
    
            afterBind();  // 切換畫面到已綁定狀態
            alert("綁定成功");
        };
    
        // --- 解除綁定 ---
        unbindBtn.onclick = () => {
            // 移除 localStorage 的帳號、密碼及推播設定
            localStorage.removeItem("account");
            localStorage.removeItem("password");
            localStorage.removeItem("push"); 
    
            afterUnbind(); // 切換畫面到未綁定狀態
            alert("已解除綁定");
        };
    
        // --- 送出推播設定 ---
        pushBtn.onclick = () => {
            const selected = [...pushRadios].find(r => r.checked).value;  // 找出目前被選取的 radio 值
            localStorage.setItem("push", selected); // 儲存到 localStorage
            alert("推播設定已更新為：" + (selected === "on" ? "開啟" : "關閉"));
        };
    };
    </script>
    

<body>
<div class="container">
    <!-- === 標題區 === -->
    <div class="title-column">
        <div class="icon-group">
            <div class="icon-left">
                <img src="images/DPS_logo.jpg" alt="">
            </div>
            <div class="icon-right">
                <img src="images/fire1.png" alt="">
            </div>
        </div>
        <h1>CFB監控-LINE服務</h1>
    </div>

    <!-- === 使用方法區 === -->
    <div class="guide">
        <b>使用方法：</b>
        <ol>
            <li>輸入CFB平台的帳號與密碼。</li>
            <li>按下「綁定」後，將會與Line串聯。</li>
            <li>需先按「解除」，再重新輸入帳號密碼。</li>
            <li>綁定後會收到防火毯異常警訊通知。</li>
        </ol>
    </div>

    <!-- === 帳號密碼輸入區 === -->
    <div class="input-group">
        <label for="account">👤 帳號</label>
        <input type="text" id="account" placeholder="請輸入帳號">
    </div>
    <div class="input-group">
        <label for="password">🔒 密碼</label>
        <input type="password" id="password" placeholder="請輸入密碼">
    </div>

    <!-- === 綁定 / 解除按鈕區 === -->
    <div class="btn-area">
        <button class="bind-btn" id="bindBtn">登入</button>
        <button class="unbind-btn" id="unbindBtn">解除</button>
    </div>

    <!-- === 推播設定區 === -->
    <div class="push-section" id="pushSection">    
        <div class="push-row">
            <span>設定推播訊息：</span>
            <label><input type="radio" name="push" value="on"> 開啟</label>
            <label><input type="radio" name="push" value="off" checked> 關閉</label>
        </div>
        <button class="push-submit-btn" id="pushBtn">送出</button>
    </div>

    <!-- === 頁尾 === -->
    <div class="footer">
        <img src="images/dps.png" alt="dps-icon">
        <span>中保防災科技股份有限公司 www.dps.tw</span>
    </div>
</div>
</body>
</html>
