<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<!-- 設定手機響應式視窗大小，禁止縮放 -->
<meta name="viewport" content="width=400, height=640, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>CFB</title>

<!-- 外部 CSS -->
<link rel="stylesheet" href="style.css">

<!-- 處理帳號綁定/解除邏輯 -->
<script>
    window.onload = () => {
        // 帳號 / 密碼欄位
        const accInput  = document.getElementById("account");
        const pwdInput  = document.getElementById("password");

        // 按鈕
        const bindBtn   = document.getElementById("bindBtn");      // 綁定
        const unbindBtn = document.getElementById("unbindBtn");    // 解除

        // 推播設定區
        const pushSection = document.getElementById("pushSection");
        const pushRadios  = document.getElementsByName("push");
        const pushBtn     = document.getElementById("pushBtn");

        // --- 讀取推播設定 ---
        function loadPushSetting() {
            const savedPush = localStorage.getItem("push");
            if (savedPush === "on") {
                document.querySelector('input[name="push"][value="on"]').checked = true;
            } else {
                document.querySelector('input[name="push"][value="off"]').checked = true;
            }
        }

        // --- 依照是否已綁定帳號更新畫面 ---
        function updateUIByBindState() {
            const savedAcc = localStorage.getItem("account");

            if (savedAcc) {
                // 已綁定
                accInput.value = savedAcc;
                pwdInput.value = "********";

                accInput.readOnly = true;
                pwdInput.readOnly = true;

                // 綁定不可按、解除可按
                bindBtn.disabled   = true;
                bindBtn.classList.add("disabled");
                unbindBtn.disabled = false;
                unbindBtn.classList.remove("disabled");

                // 顯示推播卡片
                pushSection.style.display = "block";
                loadPushSetting();
            } else {
                // 未綁定
                accInput.value = "";
                pwdInput.value = "";

                accInput.readOnly = false;
                pwdInput.readOnly = false;

                bindBtn.disabled   = false;
                bindBtn.classList.remove("disabled");
                unbindBtn.disabled = true;
                unbindBtn.classList.add("disabled");

                // 隱藏推播卡片
                pushSection.style.display = "none";
                document.querySelector('input[name="push"][value="off"]').checked = true;
            }
        }

        // 初始化
        updateUIByBindState();

        // --- 綁定 ---
        bindBtn.onclick = () => {
            const acc = accInput.value.trim();
            const pwd = pwdInput.value.trim();

            if (!acc || !pwd) {
                alert("請輸入帳號與密碼");
                return;
            }

            localStorage.setItem("account", acc);
            localStorage.setItem("password", pwd);

            alert("綁定LINE帳號成功，請確認推播設定是否開啟。");
            updateUIByBindState();
        };

        // --- 解除 ---
        unbindBtn.onclick = () => {
            if (unbindBtn.disabled) return; // 沒綁定就不處理

            localStorage.removeItem("account");
            localStorage.removeItem("password");
            localStorage.removeItem("push");

            alert("已解除綁定。");
            updateUIByBindState();
        };

        // --- 儲存推播設定 ---
        pushBtn.onclick = () => {
            const selected = [...pushRadios].find(r => r.checked).value;
            localStorage.setItem("push", selected);
            alert("推播設定已更新為：" + (selected === "on" ? "開啟" : "關閉"));
        };
    };
</script>
</head>

<body>
<div class="container">
    <!-- 上方標題區塊：圖示＋標題 -->
    <div class="title-column">
        <div class="icon-box">
            <img class="logo-small" src="DPS_logo.jpg" alt="">
            <img class="fire-large" src="fire3.png" alt="">
        </div>
        <h1>CFB巡檢 - LINE服務</h1>
    </div>

    <!-- 使用方法說明區塊 -->
    <div class="guide">
        <b>使用方法：</b>
        <ol>
            <li>輸入 CFB 平台的帳號與密碼。</li>
            <li>按下「綁定LINE」後，將會與 LINE 串聯。</li>
            <li>如需變更帳號，請先按「解除綁定」，再重新綁定。</li>
            <li>綁定後可於下方調整是否接收推播通知。</li>
        </ol>
    </div>

    <!-- 🔔 通知設定卡：位置在帳號登入的上方 -->
    <div class="push-section" id="pushSection">
        <div class="push-header">通知與介面設定</div>

        <div class="push-row">
            <span class="push-label">推播通知</span>
            <label class="push-option">
                <input type="radio" name="push" value="on"> 開啟
            </label>
            <label class="push-option">
                <input type="radio" name="push" value="off" checked> 關閉
            </label>
        </div>

        <div class="push-note">
            ※ 開啟後，CFB 有異常時會立即透過 LINE 提醒您。
        </div>

        <button class="push-submit-btn" id="pushBtn">儲存設定</button>
    </div>

    <!-- 帳號密碼輸入區塊（表單卡） -->
    <div class="form-card">
        <div class="input-group">
            <label for="account">👤 帳號</label>
            <input type="text" id="account" placeholder="請輸入帳號">
        </div>

        <div class="input-group">
            <label for="password">🔒 密碼</label>
            <input type="password" id="password" placeholder="請輸入密碼">
        </div>

        <div class="btn-area">
            <button class="bind-btn" id="bindBtn">綁定LINE</button>
            <button class="unbind-btn" id="unbindBtn">解除綁定</button>
        </div>
    </div>

    <!-- 頁尾 -->
    <div class="footer">
        <img src="dps.png" alt="dps-icon">
        <span>中保防災科技股份有限公司 www.dps.tw</span>
    </div>
</div>
</body>
</html>

